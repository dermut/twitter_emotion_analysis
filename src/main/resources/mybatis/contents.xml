<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="contents">
  <insert id="create" parameterType="ContentsVO">
    INSERT INTO contents(name, content, views, replies, size, 
                         photo, thumb, rdate, boardno, memberno)  
    VALUES(#{name}, #{content}, #{views}, #{replies}, #{size},
           #{photo}, #{thumb}, now(), #{boardno}, #{memberno})
  </insert>
  
  <select id="list_all_board" resultType="ContentsVO">
    SELECT contentsno, name, content, views, replies, size, 
           photo, thumb, rdate, boardno, memberno
    FROM contents
    ORDER BY contentsno ASC
  </select>
  
  <select id="total_count" resultType="int">
    SELECT COUNT(*) as count
    FROM contents
  </select>
  
  <select id="list_by_board" resultType="ContentsVO" parameterType="int">
    SELECT contentsno, name, content, views, replies, size, 
           photo, thumb, rdate, boardno, memberno
    FROM contents 
    WHERE boardno=#{boardno}
    ORDER BY contentsno ASC
  </select>
  
  <select id="read" resultType="ContentsVO" parameterType="int">
    SELECT contentsno, name, content, views, replies, size, 
           photo, thumb, rdate, boardno, memberno
    FROM contents
    WHERE contentsno=#{contentsno}
  </select>
  
  <update id="update" parameterType="ContentsVO">
    UPDATE contents
    SET name=#{name}, content=#{content},
        thumb=#{thumb}, photo=#{photo}, size=#{size}
    WHERE contentsno=#{contentsno}
  </update>
  
  <delete id="delete" parameterType="int">
    DELETE FROM contents
    WHERE contentsno=#{contentsno}
  </delete>

  <!-- board별 검색된 레코드 목록 -->
<!--   <select id="list_by_board_search" resultType="ContentsVO" parameterType="HashMap"> -->
<!--     SELECT contentsno, name, content, views, replies, size,  -->
<!--            photo, thumb, rdate, boardno, memberno -->
<!--     FROM contents -->
<!--     <choose> -->
<!--       <when test="word == null or word == ''"> 검색하지 않는 경우 -->
<!--         WHERE boardno=#{boardno} -->
<!--       </when> -->
<!--       <otherwise> -->
<!--         WHERE boardno=#{boardno} AND word LIKE '%' || #{word} || '%'   -->
<!--       </otherwise> -->
<!--     </choose> -->
<!--     ORDER BY contentsno DESC -->
<!--   </select> -->

  <!--   board별 검색된 레코드 갯수 -->
  <select id="search_count" resultType="int" parameterType="HashMap">
    SELECT COUNT(*) as cnt
    FROM contents
    <choose>
      <when test="word == null or word == ''"> <!-- 검색하지 않는 경우 -->
        WHERE boardno=#{boardno}
      </when>
      <otherwise>
        WHERE boardno=#{boardno} AND word LIKE '%' || #{word} || '%'  
      </otherwise>
    </choose>
  </select>

  <!-- board별 검색된 레코드 목록 + 페이징 -->
<!--   <select id="list_by_board_search_paging2" resultType="ContentsVO" parameterType="HashMap"> -->
<!--     SELECT memberno, contentsno,  name, content, views, replies, size,  -->
<!--            photo, thumb, rdate, boardno, memberno, r -->
<!--     FROM ( -->
<!--               SELECT memberno, contentsno,  name, content, views, replies, size,  -->
<!--                      photo, thumb, rdate, boardno, memberno, rownum as r -->
<!--               FROM ( -->
<!--                         SELECT m.memberno, c.contentsno, c.name, c.content, c.views, c.replies, -->
<!--                                c.size, c.photo, c.thumb, c.rdate, c.boardno, c.memberno -->
<!--                         FROM member m, contents c -->
<!--                         <choose> -->
<!--                           <when test="word == null or word == ''"> 검색하지 않는 경우 -->
<!--                             WHERE m.memberno = c.memberno AND boardno=#{boardno} -->
<!--                           </when> -->
<!--                           <otherwise> 검색하는 경우 -->
<!--                             WHERE m.memberno = c.memberno AND boardno=#{boardno} AND word LIKE '%' || #{word} || '%'   -->
<!--                           </otherwise> -->
<!--                         </choose> -->
<!--                         ORDER BY c.contentsno ASC -->
<!--               )             -->
<!--     ) -->
<!--     WHERE <![CDATA[ r >= #{startNum} AND r <= #{endNum} ]]>  -->
<!--         WHERE r >= #{startNum} AND r <= #{endNum} -->
    
<!--   </select> -->

  <!-- ******************** 답변 관련 시작 ******************** -->
  
  <!-- 답변  -->
  <insert id="reply" parameterType="Contents_ReplyVO">
    INSERT INTO reply(content, contentsno, memberno)
    VALUES(#{content}, #{contentsno}, #{memberno})
  </insert>
  
  <!-- ******************** 답변 관련 종료 ******************** -->
    

</mapper>








